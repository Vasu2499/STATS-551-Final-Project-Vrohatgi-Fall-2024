% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
\PassOptionsToPackage{dvipsnames,svgnames,x11names}{xcolor}
%
\documentclass[
  12pt,
]{article}

\usepackage{amsmath,amssymb}
\usepackage{iftex}
\ifPDFTeX
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
\usepackage{lmodern}
\ifPDFTeX\else  
    % xetex/luatex font selection
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\setlength{\emergencystretch}{3em} % prevent overfull lines
\setcounter{secnumdepth}{-\maxdimen} % remove section numbering
% Make \paragraph and \subparagraph free-standing
\makeatletter
\ifx\paragraph\undefined\else
  \let\oldparagraph\paragraph
  \renewcommand{\paragraph}{
    \@ifstar
      \xxxParagraphStar
      \xxxParagraphNoStar
  }
  \newcommand{\xxxParagraphStar}[1]{\oldparagraph*{#1}\mbox{}}
  \newcommand{\xxxParagraphNoStar}[1]{\oldparagraph{#1}\mbox{}}
\fi
\ifx\subparagraph\undefined\else
  \let\oldsubparagraph\subparagraph
  \renewcommand{\subparagraph}{
    \@ifstar
      \xxxSubParagraphStar
      \xxxSubParagraphNoStar
  }
  \newcommand{\xxxSubParagraphStar}[1]{\oldsubparagraph*{#1}\mbox{}}
  \newcommand{\xxxSubParagraphNoStar}[1]{\oldsubparagraph{#1}\mbox{}}
\fi
\makeatother

\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{241,243,245}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.40,0.45,0.13}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\BuiltInTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.13,0.47,0.30}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{\textit{#1}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{\textit{#1}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\ExtensionTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.28,0.35,0.67}{#1}}
\newcommand{\ImportTok}[1]{\textcolor[rgb]{0.00,0.46,0.62}{#1}}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\RegionMarkerTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.13,0.47,0.30}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.13,0.47,0.30}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.07,0.07,0.07}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.13,0.47,0.30}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{\textit{#1}}}

\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}\usepackage{longtable,booktabs,array}
\usepackage{calc} % for calculating minipage widths
% Correct order of tables after \paragraph or \subparagraph
\usepackage{etoolbox}
\makeatletter
\patchcmd\longtable{\par}{\if@noskipsec\mbox{}\fi\par}{}{}
\makeatother
% Allow footnotes in longtable head/foot
\IfFileExists{footnotehyper.sty}{\usepackage{footnotehyper}}{\usepackage{footnote}}
\makesavenoteenv{longtable}
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother

\usepackage{setspace}
\setstretch{1.0}
\usepackage{geometry}
\geometry{margin=0.6in}
\usepackage{parskip}
\setlength{\parskip}{0.3em}
\setlength{\parindent}{0.1em}
\usepackage{listings}
\lstset{ breaklines=true, breakatwhitespace=true, basicstyle=\ttfamily\small, columns=fullflexible}
\usepackage{graphicx}
\usepackage{longtable}
\usepackage{caption}
\captionsetup{width=\textwidth}
\makeatletter
\@ifpackageloaded{caption}{}{\usepackage{caption}}
\AtBeginDocument{%
\ifdefined\contentsname
  \renewcommand*\contentsname{Table of contents}
\else
  \newcommand\contentsname{Table of contents}
\fi
\ifdefined\listfigurename
  \renewcommand*\listfigurename{List of Figures}
\else
  \newcommand\listfigurename{List of Figures}
\fi
\ifdefined\listtablename
  \renewcommand*\listtablename{List of Tables}
\else
  \newcommand\listtablename{List of Tables}
\fi
\ifdefined\figurename
  \renewcommand*\figurename{Figure}
\else
  \newcommand\figurename{Figure}
\fi
\ifdefined\tablename
  \renewcommand*\tablename{Table}
\else
  \newcommand\tablename{Table}
\fi
}
\@ifpackageloaded{float}{}{\usepackage{float}}
\floatstyle{ruled}
\@ifundefined{c@chapter}{\newfloat{codelisting}{h}{lop}}{\newfloat{codelisting}{h}{lop}[chapter]}
\floatname{codelisting}{Listing}
\newcommand*\listoflistings{\listof{codelisting}{List of Listings}}
\makeatother
\makeatletter
\makeatother
\makeatletter
\@ifpackageloaded{caption}{}{\usepackage{caption}}
\@ifpackageloaded{subcaption}{}{\usepackage{subcaption}}
\makeatother

\ifLuaTeX
  \usepackage{selnolig}  % disable illegal ligatures
\fi
\usepackage{bookmark}

\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\urlstyle{same} % disable monospaced font for URLs
\hypersetup{
  pdftitle={Data Consolidation and Visualization},
  colorlinks=true,
  linkcolor={blue},
  filecolor={Maroon},
  citecolor={Blue},
  urlcolor={Blue},
  pdfcreator={LaTeX via pandoc}}


\title{Data Consolidation and Visualization}
\author{}
\date{}

\begin{document}
\maketitle


\begin{verbatim}
-- Attaching core tidyverse packages ------------------------ tidyverse 2.0.0 --
v dplyr     1.1.4     v readr     2.1.5
v forcats   1.0.0     v stringr   1.5.1
v ggplot2   3.5.1     v tibble    3.2.1
v lubridate 1.9.4     v tidyr     1.3.1
v purrr     1.0.2     
-- Conflicts ------------------------------------------ tidyverse_conflicts() --
x dplyr::filter() masks stats::filter()
x dplyr::lag()    masks stats::lag()
i Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors

Attaching package: 'zoo'


The following objects are masked from 'package:base':

    as.Date, as.Date.numeric
\end{verbatim}

\subsubsection{AQI Data - Averaging and
Consolidating}\label{aqi-data---averaging-and-consolidating}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{aqi1 }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"annual\_aqi\_by\_county\_2006.csv"}\NormalTok{)}
\FunctionTok{colnames}\NormalTok{(aqi1)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1] "State"                               "County"                             
 [3] "Year"                                "Days.with.AQI"                      
 [5] "Good.Days"                           "Moderate.Days"                      
 [7] "Unhealthy.for.Sensitive.Groups.Days" "Unhealthy.Days"                     
 [9] "Very.Unhealthy.Days"                 "Hazardous.Days"                     
[11] "Max.AQI"                             "X90th.Percentile.AQI"               
[13] "Median.AQI"                          "Days.CO"                            
[15] "Days.NO2"                            "Days.Ozone"                         
[17] "Days.PM2.5"                          "Days.PM10"                          
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# aqi1}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(dplyr)}
\FunctionTok{library}\NormalTok{(readr)}
\FunctionTok{library}\NormalTok{(janitor)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}

Attaching package: 'janitor'
\end{verbatim}

\begin{verbatim}
The following objects are masked from 'package:stats':

    chisq.test, fisher.test
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(tidyr)}


\NormalTok{process\_year\_data }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(year) \{}
  \ControlFlowTok{if}\NormalTok{ (year }\SpecialCharTok{==} \DecValTok{2020}\NormalTok{) \{}
    \FunctionTok{return}\NormalTok{(}\ConstantTok{NULL}\NormalTok{)  }
\NormalTok{  \}}
  
  
\NormalTok{  file\_name }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\StringTok{"annual\_aqi\_by\_county\_"}\NormalTok{, year, }\StringTok{".csv"}\NormalTok{)}
  
  
\NormalTok{  data }\OtherTok{\textless{}{-}} \FunctionTok{read\_csv}\NormalTok{(file\_name, }\AttributeTok{show\_col\_types =} \ConstantTok{FALSE}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{clean\_names}\NormalTok{()}
  
  
\NormalTok{  required\_columns }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"max\_aqi"}\NormalTok{, }\StringTok{"x90th\_percentile\_aqi"}\NormalTok{, }\StringTok{"median\_aqi"}\NormalTok{,}
                        \StringTok{"days\_with\_aqi"}\NormalTok{, }\StringTok{"good\_days"}\NormalTok{, }
                        \StringTok{"moderate\_days"}\NormalTok{,}
                        \StringTok{"unhealthy\_for\_sensitive\_groups\_days"}\NormalTok{,}
                        \StringTok{"unhealthy\_days"}\NormalTok{,}\StringTok{"very\_unhealthy\_days"}\NormalTok{,}
                        \StringTok{"hazardous\_days"}\NormalTok{,}
                        \StringTok{"days\_co"}\NormalTok{, }\StringTok{"days\_no2"}\NormalTok{, }\StringTok{"days\_ozone"}\NormalTok{, }
                        \StringTok{"days\_pm2\_5"}\NormalTok{, }\StringTok{"days\_pm10"}\NormalTok{)}
  
  
\NormalTok{  missing\_columns }\OtherTok{\textless{}{-}} \FunctionTok{setdiff}\NormalTok{(required\_columns, }\FunctionTok{colnames}\NormalTok{(data))}
  \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{length}\NormalTok{(missing\_columns) }\SpecialCharTok{\textgreater{}} \DecValTok{0}\NormalTok{) \{}
    \FunctionTok{warning}\NormalTok{(}\StringTok{"Missing columns in "}\NormalTok{, year, }\StringTok{": "}\NormalTok{, }
            \FunctionTok{paste}\NormalTok{(missing\_columns, }\AttributeTok{collapse =} \StringTok{", "}\NormalTok{))}
    \FunctionTok{return}\NormalTok{(}\ConstantTok{NULL}\NormalTok{)  }
\NormalTok{  \}}
  
\NormalTok{  state\_avg\_aqi }\OtherTok{\textless{}{-}}\NormalTok{ data }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{group\_by}\NormalTok{(state) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{summarise}\NormalTok{(}
      \AttributeTok{avg\_max\_aqi =} \FunctionTok{mean}\NormalTok{(max\_aqi, }
                         \AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
      \AttributeTok{avg\_x90th\_percentile\_aqi =} \FunctionTok{mean}\NormalTok{(x90th\_percentile\_aqi, }
                                      \AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
      \AttributeTok{avg\_median\_aqi =} \FunctionTok{mean}\NormalTok{(median\_aqi, }
                            \AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
      \AttributeTok{avg\_days\_with\_aqi =} \FunctionTok{mean}\NormalTok{(days\_with\_aqi, }
                               \AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
      \AttributeTok{avg\_good\_days =} \FunctionTok{mean}\NormalTok{(good\_days, }
                           \AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
      \AttributeTok{avg\_moderate\_days =} \FunctionTok{mean}\NormalTok{(moderate\_days, }
                               \AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
      \AttributeTok{avg\_unhealthy\_for\_sensitive\_groups\_days =}\NormalTok{ mean}
\NormalTok{      (unhealthy\_for\_sensitive\_groups\_days, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
      \AttributeTok{avg\_unhealthy\_days =} \FunctionTok{mean}\NormalTok{(unhealthy\_days, }
                                \AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
      \AttributeTok{avg\_very\_unhealthy\_days =} \FunctionTok{mean}\NormalTok{(very\_unhealthy\_days, }
                                     \AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
      \AttributeTok{avg\_hazardous\_days =} \FunctionTok{mean}\NormalTok{(hazardous\_days, }
                                \AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
      \AttributeTok{avg\_days\_co =} \FunctionTok{mean}\NormalTok{(days\_co, }
                         \AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
      \AttributeTok{avg\_days\_no2 =} \FunctionTok{mean}\NormalTok{(days\_no2, }
                          \AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
      \AttributeTok{avg\_days\_ozone =} \FunctionTok{mean}\NormalTok{(days\_ozone, }
                            \AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
      \AttributeTok{avg\_days\_pm2\_5 =} \FunctionTok{mean}\NormalTok{(days\_pm2\_5, }
                            \AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
      \AttributeTok{avg\_days\_pm10 =} \FunctionTok{mean}\NormalTok{(days\_pm10, }
                           \AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{    ) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{mutate}\NormalTok{(}\AttributeTok{year =}\NormalTok{ year)  }
  
  \FunctionTok{return}\NormalTok{(state\_avg\_aqi)}
\NormalTok{\}}

\CommentTok{\# Process data for all years, excluding 2020}
\NormalTok{years }\OtherTok{\textless{}{-}} \FunctionTok{setdiff}\NormalTok{(}\DecValTok{1999}\SpecialCharTok{:}\DecValTok{2021}\NormalTok{, }\DecValTok{2020}\NormalTok{)}

\NormalTok{all\_years\_data }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(years, }\ControlFlowTok{function}\NormalTok{(year) \{}
\NormalTok{  data }\OtherTok{\textless{}{-}} \FunctionTok{process\_year\_data}\NormalTok{(year)}
  \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{is.null}\NormalTok{(data)) \{}
    \FunctionTok{return}\NormalTok{(data)}
\NormalTok{  \}}
\NormalTok{\}) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{bind\_rows}\NormalTok{()  }

\CommentTok{\# Create imputed 2020 data by averaging other years\textquotesingle{} data}
\NormalTok{impute\_2020\_data }\OtherTok{\textless{}{-}}\NormalTok{ all\_years\_data }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(state) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{summarise}\NormalTok{(}
    \AttributeTok{avg\_max\_aqi =} \FunctionTok{mean}\NormalTok{(avg\_max\_aqi, }
                       \AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
    \AttributeTok{avg\_x90th\_percentile\_aqi =} \FunctionTok{mean}\NormalTok{(avg\_x90th\_percentile\_aqi, }
                                    \AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
    \AttributeTok{avg\_median\_aqi =} \FunctionTok{mean}\NormalTok{(avg\_median\_aqi, }
                          \AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
    \AttributeTok{avg\_days\_with\_aqi =} \FunctionTok{mean}\NormalTok{(avg\_days\_with\_aqi, }
                             \AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
    \AttributeTok{avg\_good\_days =} \FunctionTok{mean}\NormalTok{(avg\_good\_days, }
                         \AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
    \AttributeTok{avg\_moderate\_days =} \FunctionTok{mean}\NormalTok{(avg\_moderate\_days, }
                             \AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
    \AttributeTok{avg\_unhealthy\_for\_sensitive\_groups\_days =}\NormalTok{ mean}
\NormalTok{    (avg\_unhealthy\_for\_sensitive\_groups\_days, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
    \AttributeTok{avg\_unhealthy\_days =} \FunctionTok{mean}\NormalTok{(avg\_unhealthy\_days, }
                              \AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
    \AttributeTok{avg\_very\_unhealthy\_days =} \FunctionTok{mean}\NormalTok{(avg\_very\_unhealthy\_days, }
                                   \AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
    \AttributeTok{avg\_hazardous\_days =} \FunctionTok{mean}\NormalTok{(avg\_hazardous\_days, }
                              \AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
    \AttributeTok{avg\_days\_co =} \FunctionTok{mean}\NormalTok{(avg\_days\_co, }
                       \AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
    \AttributeTok{avg\_days\_no2 =} \FunctionTok{mean}\NormalTok{(avg\_days\_no2, }
                        \AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
    \AttributeTok{avg\_days\_ozone =} \FunctionTok{mean}\NormalTok{(avg\_days\_ozone, }
                          \AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
    \AttributeTok{avg\_days\_pm2\_5 =} \FunctionTok{mean}\NormalTok{(avg\_days\_pm2\_5, }
                          \AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
    \AttributeTok{avg\_days\_pm10 =} \FunctionTok{mean}\NormalTok{(avg\_days\_pm10, }
                         \AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{  ) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{year =} \DecValTok{2020}\NormalTok{)  }

\CommentTok{\# Combine the original data }
\NormalTok{aqi\_final\_data }\OtherTok{\textless{}{-}} \FunctionTok{bind\_rows}\NormalTok{(all\_years\_data, impute\_2020\_data)}

\FunctionTok{write\_csv}\NormalTok{(aqi\_final\_data, }\StringTok{"state\_avg\_aqi\_1999\_2021\_with\_imputed\_2020.csv"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ncol}\NormalTok{(aqi\_final\_data)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 17
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{summary}\NormalTok{(aqi\_final\_data)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
    state            avg_max_aqi      avg_x90th_percentile_aqi avg_median_aqi 
 Length:1251        Min.   :  58.25   Min.   : 30.50           Min.   :15.25  
 Class :character   1st Qu.: 101.03   1st Qu.: 56.13           1st Qu.:35.40  
 Mode  :character   Median : 120.13   Median : 63.00           Median :40.95  
                    Mean   : 133.11   Mean   : 66.93           Mean   :40.49  
                    3rd Qu.: 146.17   3rd Qu.: 74.94           3rd Qu.:45.46  
                    Max.   :1046.67   Max.   :141.00           Max.   :74.67  
 avg_days_with_aqi avg_good_days   avg_moderate_days
 Min.   : 32.0     Min.   :  8.0   Min.   :  5.50   
 1st Qu.:251.8     1st Qu.:153.4   1st Qu.: 62.44   
 Median :288.2     Median :192.5   Median : 85.25   
 Mean   :283.6     Mean   :189.5   Mean   : 85.80   
 3rd Qu.:329.6     3rd Qu.:225.7   3rd Qu.:106.45   
 Max.   :366.0     Max.   :356.2   Max.   :277.00   
 avg_unhealthy_for_sensitive_groups_days avg_unhealthy_days
 Min.   : 0.000                          Min.   : 0.00000  
 1st Qu.: 1.181                          1st Qu.: 0.04762  
 Median : 3.688                          Median : 0.30450  
 Mean   : 6.634                          Mean   : 1.42964  
 3rd Qu.: 9.342                          3rd Qu.: 1.37798  
 Max.   :58.667                          Max.   :26.33333  
 avg_very_unhealthy_days avg_hazardous_days  avg_days_co     
 Min.   : 0.00000        Min.   :0.00000    Min.   : 0.0000  
 1st Qu.: 0.00000        1st Qu.:0.00000    1st Qu.: 0.0000  
 Median : 0.00000        Median :0.00000    Median : 0.1333  
 Mean   : 0.21024        Mean   :0.05039    Mean   : 3.9655  
 3rd Qu.: 0.07596        3rd Qu.:0.00000    3rd Qu.: 1.9683  
 Max.   :15.00000        Max.   :2.66667    Max.   :75.1333  
  avg_days_no2      avg_days_ozone   avg_days_pm2_5   avg_days_pm10   
 Min.   :  0.0000   Min.   :  0.00   Min.   :  0.00   Min.   :  0.00  
 1st Qu.:  0.6085   1st Qu.: 95.27   1st Qu.: 69.16   1st Qu.:  0.50  
 Median :  3.1333   Median :146.17   Median :104.27   Median :  8.00  
 Mean   :  8.7656   Mean   :136.86   Mean   :115.55   Mean   : 18.49  
 3rd Qu.: 10.0000   3rd Qu.:179.55   3rd Qu.:151.88   3rd Qu.: 23.52  
 Max.   :143.0000   Max.   :291.00   Max.   :346.00   Max.   :173.50  
      year     
 Min.   :1999  
 1st Qu.:2004  
 Median :2010  
 Mean   :2010  
 3rd Qu.:2016  
 Max.   :2021  
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{str}\NormalTok{(aqi\_final\_data)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
tibble [1,251 x 17] (S3: tbl_df/tbl/data.frame)
 $ state                                  : chr [1:1251] "Alabama" "Alaska" "Arizona" "Arkansas" ...
 $ avg_max_aqi                            : num [1:1251] 146 107 126 113 222 ...
 $ avg_x90th_percentile_aqi               : num [1:1251] 93.6 51.7 79.4 81.1 103.4 ...
 $ avg_median_aqi                         : num [1:1251] 54.4 23.7 48.8 55.4 51.6 ...
 $ avg_days_with_aqi                      : num [1:1251] 184 194 221 119 328 ...
 $ avg_good_days                          : num [1:1251] 69.8 167.7 104.2 69.3 177.1 ...
 $ avg_moderate_days                      : num [1:1251] 88.4 24.7 91.4 41.9 95.7 ...
 $ avg_unhealthy_for_sensitive_groups_days: num [1:1251] 20 1.5 23.33 6.39 36.91 ...
 $ avg_unhealthy_days                     : num [1:1251] 5.667 0.333 2.167 1.278 16.696 ...
 $ avg_very_unhealthy_days                : num [1:1251] 0.429 0 0 0 1.821 ...
 $ avg_hazardous_days                     : num [1:1251] 0 0 0 0 0.196 ...
 $ avg_days_co                            : num [1:1251] 2.238 49.333 0.25 0.833 3.339 ...
 $ avg_days_no2                           : num [1:1251] 0 0 12.67 2.11 45.95 ...
 $ avg_days_ozone                         : num [1:1251] 93.2 59.7 145.9 85.7 220.6 ...
 $ avg_days_pm2_5                         : num [1:1251] 71.5 50.2 37.8 30.2 45.8 ...
 $ avg_days_pm10                          : num [1:1251] 17.333 35 24.5 0.167 12.786 ...
 $ year                                   : num [1:1251] 1999 1999 1999 1999 1999 ...
\end{verbatim}

\subsubsection{Loading the ``Cancer Incidence''
Data}\label{loading-the-cancer-incidence-data}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Load the data}
\NormalTok{cancer\_incidence }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"cancer\_incidence.csv"}\NormalTok{)}

\CommentTok{\# Convert \textquotesingle{}Count\textquotesingle{} and \textquotesingle{}Population\textquotesingle{} to numeric}
\NormalTok{cancer\_incidence}\SpecialCharTok{$}\NormalTok{Count }\OtherTok{\textless{}{-}} \FunctionTok{as.numeric}\NormalTok{(cancer\_incidence}\SpecialCharTok{$}\NormalTok{Count)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Warning: NAs introduced by coercion
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{cancer\_incidence}\SpecialCharTok{$}\NormalTok{Population }\OtherTok{\textless{}{-}} \FunctionTok{as.numeric}\NormalTok{(cancer\_incidence}\SpecialCharTok{$}\NormalTok{Population)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Warning: NAs introduced by coercion
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Remove \textquotesingle{}Crude.Rate\textquotesingle{} column}
\NormalTok{cancer\_incidence }\OtherTok{\textless{}{-}}\NormalTok{ cancer\_incidence }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{Crude.Rate)}

\CommentTok{\# Aggregate data by State, Year (across both sexes)}
\NormalTok{cancer\_aggregated }\OtherTok{\textless{}{-}}\NormalTok{ cancer\_incidence }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(States, Year) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{summarise}\NormalTok{(}
    \AttributeTok{Total\_Count =} \FunctionTok{sum}\NormalTok{(Count, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{), }
    \AttributeTok{Total\_Population =} \FunctionTok{sum}\NormalTok{(Population, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{  )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
`summarise()` has grouped output by 'States'. You can override using the
`.groups` argument.
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# View the resulting aggregated data}
\FunctionTok{head}\NormalTok{(cancer\_aggregated)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 6 x 4
# Groups:   States [1]
  States   Year Total_Count Total_Population
  <chr>   <int>       <dbl>            <dbl>
1 Alabama  1999          41           194723
2 Alabama  2000          51           220789
3 Alabama  2001          79           442183
4 Alabama  2002          34           378534
5 Alabama  2003          53           474259
6 Alabama  2004          54           313205
\end{verbatim}

\subsubsection{Ensuring Data Integrity and Processing the Next Data
Set}\label{ensuring-data-integrity-and-processing-the-next-data-set}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{aqi\_data }\OtherTok{\textless{}{-}}\NormalTok{ aqi\_final\_data}
\NormalTok{can\_in }\OtherTok{\textless{}{-}}\NormalTok{ cancer\_aggregated}


\NormalTok{aqi\_data}\SpecialCharTok{$}\NormalTok{year }\OtherTok{\textless{}{-}} \FunctionTok{as.integer}\NormalTok{(}\FunctionTok{as.character}\NormalTok{(aqi\_data}\SpecialCharTok{$}\NormalTok{year))}
\NormalTok{can\_in}\SpecialCharTok{$}\NormalTok{Year }\OtherTok{\textless{}{-}} \FunctionTok{as.integer}\NormalTok{(}\FunctionTok{as.character}\NormalTok{(can\_in}\SpecialCharTok{$}\NormalTok{Year))}


\FunctionTok{names}\NormalTok{(aqi\_data)[}\FunctionTok{names}\NormalTok{(aqi\_data) }\SpecialCharTok{==} \StringTok{"state"}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{"States"}  
\FunctionTok{names}\NormalTok{(can\_in)[}\FunctionTok{names}\NormalTok{(can\_in) }\SpecialCharTok{==} \StringTok{"States"}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{"States"}   


\NormalTok{can\_in\_complete }\OtherTok{\textless{}{-}}\NormalTok{ can\_in }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}
    \AttributeTok{Total\_Count =} \FunctionTok{ifelse}\NormalTok{(}\FunctionTok{is.na}\NormalTok{(Total\_Count), }\DecValTok{0}\NormalTok{, Total\_Count),}
    \AttributeTok{Total\_Population =}\NormalTok{ ifelse}
\NormalTok{    (}\FunctionTok{is.na}\NormalTok{(Total\_Population), }\DecValTok{0}\NormalTok{, Total\_Population)}
\NormalTok{  )}

\NormalTok{final\_merged\_data }\OtherTok{\textless{}{-}} \FunctionTok{left\_join}\NormalTok{(aqi\_data, can\_in\_complete, }
                               \AttributeTok{by =} \FunctionTok{c}\NormalTok{(}\StringTok{"States"}\NormalTok{, }\StringTok{"year"} \OtherTok{=} \StringTok{"Year"}\NormalTok{))}

\FunctionTok{head}\NormalTok{(final\_merged\_data)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 6 x 19
  States     avg_max_aqi avg_x90th_percentile~1 avg_median_aqi avg_days_with_aqi
  <chr>            <dbl>                  <dbl>          <dbl>             <dbl>
1 Alabama           146.                   93.6           54.4              184.
2 Alaska            107                    51.7           23.7              194.
3 Arizona           126.                   79.4           48.8              221.
4 Arkansas          113.                   81.1           55.4              119.
5 California        222.                  103.            51.6              328.
6 Canada            133                    47             34                188 
# i abbreviated name: 1: avg_x90th_percentile_aqi
# i 14 more variables: avg_good_days <dbl>, avg_moderate_days <dbl>,
#   avg_unhealthy_for_sensitive_groups_days <dbl>, avg_unhealthy_days <dbl>,
#   avg_very_unhealthy_days <dbl>, avg_hazardous_days <dbl>, avg_days_co <dbl>,
#   avg_days_no2 <dbl>, avg_days_ozone <dbl>, avg_days_pm2_5 <dbl>,
#   avg_days_pm10 <dbl>, year <int>, Total_Count <dbl>, Total_Population <dbl>
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{str}\NormalTok{(final\_merged\_data)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
tibble [1,251 x 19] (S3: tbl_df/tbl/data.frame)
 $ States                                 : chr [1:1251] "Alabama" "Alaska" "Arizona" "Arkansas" ...
 $ avg_max_aqi                            : num [1:1251] 146 107 126 113 222 ...
 $ avg_x90th_percentile_aqi               : num [1:1251] 93.6 51.7 79.4 81.1 103.4 ...
 $ avg_median_aqi                         : num [1:1251] 54.4 23.7 48.8 55.4 51.6 ...
 $ avg_days_with_aqi                      : num [1:1251] 184 194 221 119 328 ...
 $ avg_good_days                          : num [1:1251] 69.8 167.7 104.2 69.3 177.1 ...
 $ avg_moderate_days                      : num [1:1251] 88.4 24.7 91.4 41.9 95.7 ...
 $ avg_unhealthy_for_sensitive_groups_days: num [1:1251] 20 1.5 23.33 6.39 36.91 ...
 $ avg_unhealthy_days                     : num [1:1251] 5.667 0.333 2.167 1.278 16.696 ...
 $ avg_very_unhealthy_days                : num [1:1251] 0.429 0 0 0 1.821 ...
 $ avg_hazardous_days                     : num [1:1251] 0 0 0 0 0.196 ...
 $ avg_days_co                            : num [1:1251] 2.238 49.333 0.25 0.833 3.339 ...
 $ avg_days_no2                           : num [1:1251] 0 0 12.67 2.11 45.95 ...
 $ avg_days_ozone                         : num [1:1251] 93.2 59.7 145.9 85.7 220.6 ...
 $ avg_days_pm2_5                         : num [1:1251] 71.5 50.2 37.8 30.2 45.8 ...
 $ avg_days_pm10                          : num [1:1251] 17.333 35 24.5 0.167 12.786 ...
 $ year                                   : int [1:1251] 1999 1999 1999 1999 1999 1999 1999 1999 1999 1999 ...
 $ Total_Count                            : num [1:1251] 41 0 93 0 2028 ...
 $ Total_Population                       : num [1:1251] 194723 261961 475824 196611 31858924 ...
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{write\_csv}\NormalTok{(final\_merged\_data, }\StringTok{"merged\_aqi\_cancer\_incidence.csv"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Loading Environmental Hazard Data

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{narrowr }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"narrowresult.csv"}\NormalTok{)}
\FunctionTok{str}\NormalTok{(narrowr)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
'data.frame':   273014 obs. of  23 variables:
 $ OrganizationIdentifier                        : chr  "AK-CHIN_WQX" "AK-CHIN_WQX" "AK-CHIN_WQX" "AK-CHIN_WQX" ...
 $ OrganizationFormalName                        : chr  "Ak-Chin Indian Community (Tribal)" "Ak-Chin Indian Community (Tribal)" "Ak-Chin Indian Community (Tribal)" "Ak-Chin Indian Community (Tribal)" ...
 $ ActivityIdentifier                            : chr  "AK-CHIN_WQX-SR:SD-23:2013-10-28" "AK-CHIN_WQX-SR:SD-23:2013-12-17" "AK-CHIN_WQX-SR:SD-23:2013-9-30" "AK-CHIN_WQX-SR:SD-23:2013-10-28" ...
 $ ActivityStartDate                             : chr  "28/10/2013" "17/12/2013" "30/09/2013" "28/10/2013" ...
 $ ResultDetectionConditionText                  : chr  "" "" "" "Not Reported" ...
 $ MethodSpecificationName                       : chr  "" "" "" "" ...
 $ CharacteristicName                            : chr  "Calcium" "Calcium" "Calcium" "Chlorophyll a" ...
 $ ResultSampleFractionText                      : chr  "Fixed" "Fixed" "Fixed" "" ...
 $ ResultMeasureValue                            : chr  "65.2" "56.3" "81.7" "" ...
 $ ResultMeasure.MeasureUnitCode                 : chr  "mg/L" "mg/L" "mg/L" "" ...
 $ ResultStatusIdentifier                        : chr  "Final" "Final" "Final" "Final" ...
 $ ResultValueTypeName                           : chr  "Actual" "Actual" "Actual" "Actual" ...
 $ PrecisionValue                                : num  NA NA NA NA NA NA NA NA NA NA ...
 $ DataQuality.BiasValue                         : logi  NA NA NA NA NA NA ...
 $ USGSPCode                                     : int  NA NA NA NA NA NA NA NA NA NA ...
 $ ResultDepthHeightMeasure.MeasureValue         : num  NA NA NA NA NA NA NA NA NA NA ...
 $ ResultDepthHeightMeasure.MeasureUnitCode      : chr  "" "" "" "" ...
 $ ResultDepthAltitudeReferencePointText         : chr  "" "" "" "" ...
 $ ResultSamplingPointName                       : chr  "" "" "" "" ...
 $ ResultAnalyticalMethod.MethodName             : chr  "Nitrate-Nitrite Nitrogen by Cd Reduction" "Nitrate-Nitrite Nitrogen by Cd Reduction" "Nitrate-Nitrite Nitrogen by Cd Reduction" "Nitrite Nitrogen by Spectophotometry" ...
 $ ResultAnalyticalMethod.MethodQualifierTypeName: chr  "" "" "" "" ...
 $ AnalysisStartDate                             : chr  "" "" "" "" ...
 $ AnalysisEndDate                               : chr  "" "" "" "" ...
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{unique}\NormalTok{(narrowr}\SpecialCharTok{$}\NormalTok{OrganizationFormalName)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
  [1] "Ak-Chin Indian Community (Tribal)"                                                                                    
  [2] "ALABAMA DEPT. OF ENVIRONMENTAL MANAGEMENT - WATER QUALITY DATA"                                                       
  [3] "Animas River Stakeholders Group (Colorado) (Volunteer)"                                                               
  [4] "Arkansas Department of Environmental Quality"                                                                         
  [5] "Big Valley Band of Pomo Indians of the Big Valley Rancheria, California (Tribal)"                                     
  [6] "Boomsnub/Airco Superfund Site EPA Region 10"                                                                          
  [7] "Bunker Hill Mining and Metallurgical Complex"                                                                         
  [8] "Bureau of Reclamation"                                                                                                
  [9] "California Department Of Water Resources"                                                                             
 [10] "California Gulch (US EPA Region 8)"                                                                                   
 [11] "California State Water Resources Control Board"                                                                       
 [12] "Captain Jack Mine (Colorado)"                                                                                         
 [13] "CBS Operations Inc."                                                                                                  
 [14] "CDA TRUST"                                                                                                            
 [15] "CITY OF MARCO ISLAND"                                                                                                 
 [16] "Clear Creek Watershed Foundation (CCWF) (Volunteer)"                                                                  
 [17] "Coal Creek Watershed Coalition (Colorado)"                                                                            
 [18] "Collier County Coastal Zone Management Department (FL)"                                                               
 [19] "Collier County Pollution Control (Florida)"                                                                           
 [20] "Colorado Dept. of Public Health & Environment-WQCD"                                                                   
 [21] "Colorado Division of Reclamation, Mining and Safety (DRMS) (Volunteer)"                                               
 [22] "Colorado Mountain College Natural Resource Management"                                                                
 [23] "Colorado River Watch"                                                                                                 
 [24] "Connecticut Department Of Energy And Environmental Protection"                                                        
 [25] "Cortina Rancheria (Kletsel Dehe Wintun Nation) (Tribal)"                                                              
 [26] "Dade Environmental Resource Management (Florida)"                                                                     
 [27] "Division of Surface water (Ohio)"                                                                                     
 [28] "EA Engineering, Science and Technology Inc."                                                                          
 [29] "EPA National Aquatic Resources Survey (NARS)"                                                                         
 [30] "EPA Region 10 Boomsnub Superfund Site Data 1987-2013"                                                                 
 [31] "EPA Region 10 Superfund Bunker Hill Mining and Metallurgical Complex"                                                 
 [32] "EPA Region 4 Athens Lab (Georgia)"                                                                                    
 [33] "FDEP GROUNDWATER MANAGEMENT SECTION"                                                                                  
 [34] "FDEP TALLAHASSEE REGIONAL OPERATIONS CENTER"                                                                          
 [35] "FL Dept. of Environmental Protection"                                                                                 
 [36] "FL Dept. of Environmental Protection, Northwest District"                                                             
 [37] "Flandreau Santee Sioux Tribe (SD)"                                                                                    
 [38] "Hopi Tribe of Arizona (Tribal)"                                                                                       
 [39] "illinois epa"                                                                                                         
 [40] "Indiana STORET"                                                                                                       
 [41] "Jamestown S'Klallam Tribe (Tribal)"                                                                                   
 [42] "Kickapoo Tribe of Indians of the Kickapoo Reservation in Kansas (Tribal)"                                             
 [43] "Lake County Water Resource Management"                                                                                
 [44] "Lake Fork Watershed Stakeholders (Colorado) (Volunteer)"                                                              
 [45] "Massachusetts Department of Environmental Protection (MassDEP)"                                                       
 [46] "Maul Foster and Alongi, Inc."                                                                                         
 [47] "MBMG_WQX - Montana Bureau of Mines and Geology"                                                                       
 [48] "Midnite Mine Environmental Data"                                                                                      
 [49] "Minnesota Pollution Control Agency - Ambient Surface Water"                                                           
 [50] "Missouri Dept. of Natural Resources"                                                                                  
 [51] "Montana DEQ WQPB"                                                                                                     
 [52] "Montana PPL Corporation"                                                                                              
 [53] "Montana Volunteer Water Quality Monitoring"                                                                           
 [54] "Montana Watershed"                                                                                                    
 [55] "Morongo Band of Mission Indians (Tribal)"                                                                             
 [56] "Muckleshoot Indian Tribe (Tribal)"                                                                                    
 [57] "National Park Service Water Resources Division"                                                                       
 [58] "Navajo Nation, Arizona, New Mexico & Utah (Tribal)"                                                                   
 [59] "Nevada Division of Environmental Protection"                                                                          
 [60] "New York State Dec Division Of Water"                                                                                 
 [61] "NM Environmental Dept./SWQB"                                                                                          
 [62] "North Dakota Department Of Environmental Quality"                                                                     
 [63] "OCC - Otter Creek Coal"                                                                                               
 [64] "Oneida Nation"                                                                                                        
 [65] "P4 Production LLC, Soda Springs Plant, Idaho"                                                                         
 [66] "Palermo Wellfield Superfund Site by Geoengineers Inc. (Volunteer)*"                                                   
 [67] "Perry Co. Soil and Water District"                                                                                    
 [68] "Pueblo of Sandia Water Quality Program (New Mexico)"                                                                  
 [69] "Red Lake DNR"                                                                                                         
 [70] "Region 8 Superfund:  Standard Mine"                                                                                   
 [71] "Rhode Island"                                                                                                         
 [72] "Salt Chuck Mine, State of Alaska"                                                                                     
 [73] "San Miguel Watershed Coalition (Volunteer)*"                                                                          
 [74] "Santee Sioux Nation of Nebraska (Tribal)"                                                                             
 [75] "Schuylkill Action Network (Pennsylvania)"                                                                             
 [76] "Seminole Tribe of Florida (Tribal)"                                                                                   
 [77] "Shoalwater Bay Indian Tribe of the Shoalwater Bay Indian Reservation (Tribal)"                                        
 [78] "Skagit County"                                                                                                        
 [79] "Snoqualmie Indian Tribe (Tribal)"                                                                                     
 [80] "South Carolina Department of Environmental Services"                                                                  
 [81] "Southwest Florida Water Management District"                                                                          
 [82] "Spokane Tribe of the Spokane Reservation (Tribal)"                                                                    
 [83] "State of Oregon Dept. of Environmental Quality"                                                                       
 [84] "State of Wyoming Department of Environmental Quality Watershed Program"                                               
 [85] "Suwannee River Water Management District"                                                                             
 [86] "Table Mountain Rancheria of California (Tribal)"                                                                      
 [87] "Tacoma-Pierce County Health Department (Washington)"                                                                  
 [88] "TDEC Division of Water Resources"                                                                                     
 [89] "TerraGraphics Environmental Engineering, Inc."                                                                        
 [90] "Texas Commission on Environmental Quality"                                                                            
 [91] "Twenty-Nine Palms Tribal EPA"                                                                                         
 [92] "UD Citizen Monitoring Program"                                                                                        
 [93] "Uncompahgre Watershed Partnership (Volunteer)*"                                                                       
 [94] "USEPA Region 9"                                                                                                       
 [95] "USGS Florida Water Science Center"                                                                                    
 [96] "USGS Kansas Water Science Center"                                                                                     
 [97] "USGS Montana Water Science Center"                                                                                    
 [98] "USGS New Mexico Water Science Center"                                                                                 
 [99] "USGS Oregon Water Science Center"                                                                                     
[100] "Utah Department Of Environmental Quality"                                                                             
[101] "Ute Mountain Utes Tribe (Colorado)"                                                                                   
[102] "VIRGINIA DEPARTMENT OF ENVIRONMENTAL QUALITY"                                                                         
[103] "West Virginia Department of Environmental Protection Watershed Improvement Branch"                                    
[104] "West Virginia Department of Environmental Protection-Division of Water & Waste Management-Watershed Assessment Branch"
[105] "Wind River Environmental Quality Commission"                                                                          
[106] "Wisconsin Department of Natural Resources"                                                                            
[107] "WV Div of Environmental Protection, Office of Water Resource"                                                         
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# List of U.S. state names}
\NormalTok{states }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}
  \StringTok{"Alabama"}\NormalTok{, }\StringTok{"Alaska"}\NormalTok{, }\StringTok{"Arizona"}\NormalTok{, }\StringTok{"Arkansas"}\NormalTok{, }\StringTok{"California"}\NormalTok{, }\StringTok{"Colorado"}\NormalTok{, }
  \StringTok{"Connecticut"}\NormalTok{, }\StringTok{"Delaware"}\NormalTok{, }\StringTok{"Florida"}\NormalTok{, }\StringTok{"Georgia"}\NormalTok{, }\StringTok{"Hawaii"}\NormalTok{, }\StringTok{"Idaho"}\NormalTok{,}
  \StringTok{"Illinois"}\NormalTok{, }\StringTok{"Indiana"}\NormalTok{,}\StringTok{"Iowa"}\NormalTok{, }\StringTok{"Kansas"}\NormalTok{, }\StringTok{"Kentucky"}\NormalTok{, }\StringTok{"Louisiana"}\NormalTok{, }\StringTok{"Maine"}\NormalTok{,}
  \StringTok{"Maryland"}\NormalTok{, }\StringTok{"Massachusetts"}\NormalTok{, }\StringTok{"Michigan"}\NormalTok{, }\StringTok{"Minnesota"}\NormalTok{, }\StringTok{"Mississippi"}\NormalTok{,}
  \StringTok{"Missouri"}\NormalTok{, }\StringTok{"Montana"}\NormalTok{, }\StringTok{"Nebraska"}\NormalTok{,}\StringTok{"Nevada"}\NormalTok{, }\StringTok{"New Hampshire"}\NormalTok{, }\StringTok{"New Jersey"}\NormalTok{,}
  \StringTok{"New Mexico"}\NormalTok{, }\StringTok{"New York"}\NormalTok{, }\StringTok{"North Carolina"}\NormalTok{,}\StringTok{"North Dakota"}\NormalTok{, }\StringTok{"Ohio"}\NormalTok{,}
  \StringTok{"Oklahoma"}\NormalTok{, }\StringTok{"Oregon"}\NormalTok{, }\StringTok{"Pennsylvania"}\NormalTok{, }\StringTok{"Rhode Island"}\NormalTok{, }\StringTok{"South Carolina"}\NormalTok{,}
  \StringTok{"South Dakota"}\NormalTok{, }\StringTok{"Tennessee"}\NormalTok{, }\StringTok{"Texas"}\NormalTok{, }\StringTok{"Utah"}\NormalTok{, }\StringTok{"Vermont"}\NormalTok{,}\StringTok{"Virginia"}\NormalTok{,}
  \StringTok{"Washington"}\NormalTok{, }\StringTok{"West Virginia"}\NormalTok{, }\StringTok{"Wisconsin"}\NormalTok{, }\StringTok{"Wyoming"}
\NormalTok{)}

\CommentTok{\# Regular expression pattern to match state names}
\NormalTok{state\_pattern }\OtherTok{\textless{}{-}} \FunctionTok{str\_c}\NormalTok{(states, }\AttributeTok{collapse =} \StringTok{"|"}\NormalTok{)}


\NormalTok{narrowr }\OtherTok{\textless{}{-}}\NormalTok{ narrowr }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}
    \CommentTok{\# Handle blank or missing values first}
    \AttributeTok{OrganizationFormalName =} \FunctionTok{ifelse}\NormalTok{(}\FunctionTok{is.na}\NormalTok{(OrganizationFormalName) }\SpecialCharTok{|} 
\NormalTok{                                      OrganizationFormalName }\SpecialCharTok{==} \StringTok{""}\NormalTok{, }\StringTok{"Unknown"}\NormalTok{,}
\NormalTok{                                    OrganizationFormalName),}
    \CommentTok{\# Extract the state name if it exists in the organization name}
    \AttributeTok{State =} \FunctionTok{str\_extract}\NormalTok{(OrganizationFormalName, state\_pattern),}
    \CommentTok{\# Replace organization name with state name if a match is found}
    \AttributeTok{OrganizationFormalName =} \FunctionTok{ifelse}\NormalTok{(}\SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(State), State, }
\NormalTok{                                    OrganizationFormalName)}
\NormalTok{  )}
\NormalTok{narrowr}\SpecialCharTok{$}\NormalTok{state }\OtherTok{\textless{}{-}}\NormalTok{ narrowr}\SpecialCharTok{$}\NormalTok{OrganizationFormalName}
\CommentTok{\# View the updated dataset}
\FunctionTok{head}\NormalTok{(narrowr)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
  OrganizationIdentifier            OrganizationFormalName
1            AK-CHIN_WQX Ak-Chin Indian Community (Tribal)
2            AK-CHIN_WQX Ak-Chin Indian Community (Tribal)
3            AK-CHIN_WQX Ak-Chin Indian Community (Tribal)
4            AK-CHIN_WQX Ak-Chin Indian Community (Tribal)
5            AK-CHIN_WQX Ak-Chin Indian Community (Tribal)
6            AK-CHIN_WQX Ak-Chin Indian Community (Tribal)
               ActivityIdentifier ActivityStartDate
1 AK-CHIN_WQX-SR:SD-23:2013-10-28        28/10/2013
2 AK-CHIN_WQX-SR:SD-23:2013-12-17        17/12/2013
3  AK-CHIN_WQX-SR:SD-23:2013-9-30        30/09/2013
4 AK-CHIN_WQX-SR:SD-23:2013-10-28        28/10/2013
5 AK-CHIN_WQX-SR:SD-23:2013-10-28        28/10/2013
6  AK-CHIN_WQX-SR:SD-23:2013-9-30        30/09/2013
  ResultDetectionConditionText MethodSpecificationName CharacteristicName
1                                                                 Calcium
2                                                                 Calcium
3                                                                 Calcium
4                 Not Reported                              Chlorophyll a
5                                                               Potassium
6                                                                  Sodium
  ResultSampleFractionText ResultMeasureValue ResultMeasure.MeasureUnitCode
1                    Fixed               65.2                          mg/L
2                    Fixed               56.3                          mg/L
3                    Fixed               81.7                          mg/L
4                                                                          
5                                         6.5                          mg/L
6                    Fixed                114                          mg/L
  ResultStatusIdentifier ResultValueTypeName PrecisionValue
1                  Final              Actual             NA
2                  Final              Actual             NA
3                  Final              Actual             NA
4                  Final              Actual             NA
5                  Final              Actual             NA
6                  Final              Actual             NA
  DataQuality.BiasValue USGSPCode ResultDepthHeightMeasure.MeasureValue
1                    NA        NA                                    NA
2                    NA        NA                                    NA
3                    NA        NA                                    NA
4                    NA        NA                                    NA
5                    NA        NA                                    NA
6                    NA        NA                                    NA
  ResultDepthHeightMeasure.MeasureUnitCode
1                                         
2                                         
3                                         
4                                         
5                                         
6                                         
  ResultDepthAltitudeReferencePointText ResultSamplingPointName
1                                                              
2                                                              
3                                                              
4                                                              
5                                                              
6                                                              
                                 ResultAnalyticalMethod.MethodName
1                         Nitrate-Nitrite Nitrogen by Cd Reduction
2                         Nitrate-Nitrite Nitrogen by Cd Reduction
3                         Nitrate-Nitrite Nitrogen by Cd Reduction
4                             Nitrite Nitrogen by Spectophotometry
5                             Nitrite Nitrogen by Spectophotometry
6 DO NOT USE***4500 NH3 C ~ Ammonia in Water by Titrimetric Method
  ResultAnalyticalMethod.MethodQualifierTypeName AnalysisStartDate
1                                                                 
2                                                                 
3                                                                 
4                                                                 
5                                                                 
6                              duplicate records                  
  AnalysisEndDate State                             state
1                  <NA> Ak-Chin Indian Community (Tribal)
2                  <NA> Ak-Chin Indian Community (Tribal)
3                  <NA> Ak-Chin Indian Community (Tribal)
4                  <NA> Ak-Chin Indian Community (Tribal)
5                  <NA> Ak-Chin Indian Community (Tribal)
6                  <NA> Ak-Chin Indian Community (Tribal)
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{colnames}\NormalTok{(narrowr)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1] "OrganizationIdentifier"                        
 [2] "OrganizationFormalName"                        
 [3] "ActivityIdentifier"                            
 [4] "ActivityStartDate"                             
 [5] "ResultDetectionConditionText"                  
 [6] "MethodSpecificationName"                       
 [7] "CharacteristicName"                            
 [8] "ResultSampleFractionText"                      
 [9] "ResultMeasureValue"                            
[10] "ResultMeasure.MeasureUnitCode"                 
[11] "ResultStatusIdentifier"                        
[12] "ResultValueTypeName"                           
[13] "PrecisionValue"                                
[14] "DataQuality.BiasValue"                         
[15] "USGSPCode"                                     
[16] "ResultDepthHeightMeasure.MeasureValue"         
[17] "ResultDepthHeightMeasure.MeasureUnitCode"      
[18] "ResultDepthAltitudeReferencePointText"         
[19] "ResultSamplingPointName"                       
[20] "ResultAnalyticalMethod.MethodName"             
[21] "ResultAnalyticalMethod.MethodQualifierTypeName"
[22] "AnalysisStartDate"                             
[23] "AnalysisEndDate"                               
[24] "State"                                         
[25] "state"                                         
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{str}\NormalTok{(narrowr}\SpecialCharTok{$}\NormalTok{ActivityStartDate)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 chr [1:273014] "28/10/2013" "17/12/2013" "30/09/2013" "28/10/2013" ...
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{str}\NormalTok{(narrowr}\SpecialCharTok{$}\NormalTok{AnalysisStartDate)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 chr [1:273014] "" "" "" "" "" "" "" "" "" "" "" "" "" "" "" "" "" "" "" "" ...
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{str}\NormalTok{(narrowr}\SpecialCharTok{$}\NormalTok{AnalysisEndDate)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 chr [1:273014] "" "" "" "" "" "" "" "" "" "" "" "" "" "" "" "" "" "" "" "" ...
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(lubridate)}
\FunctionTok{library}\NormalTok{(dplyr)}

\NormalTok{processed\_dataset }\OtherTok{\textless{}{-}}\NormalTok{ narrowr }\SpecialCharTok{\%\textgreater{}\%}
  \CommentTok{\# Drop specified columns}
  \FunctionTok{select}\NormalTok{(}\SpecialCharTok{{-}}\FunctionTok{c}\NormalTok{(}
\NormalTok{    OrganizationIdentifier, state, OrganizationFormalName, }
\NormalTok{    ResultDepthAltitudeReferencePointText, }
\NormalTok{    ResultSamplingPointName, }
\NormalTok{    ResultAnalyticalMethod.MethodName, }
\NormalTok{    ActivityIdentifier, USGSPCode, }
\NormalTok{    ResultAnalyticalMethod.MethodQualifierTypeName,}
\NormalTok{    ResultDetectionConditionText,}
\NormalTok{    MethodSpecificationName, ResultStatusIdentifier,}
\NormalTok{    ResultSampleFractionText}
\NormalTok{  )) }\SpecialCharTok{\%\textgreater{}\%}
  
   
  \FunctionTok{mutate}\NormalTok{(}
     
    \AttributeTok{ActivityStartDate =} \FunctionTok{ifelse}\NormalTok{(ActivityStartDate }\SpecialCharTok{==} \StringTok{""} \SpecialCharTok{|} 
                                 \FunctionTok{is.na}\NormalTok{(ActivityStartDate), }\ConstantTok{NA}\NormalTok{,}
\NormalTok{                               ActivityStartDate),}
    \AttributeTok{AnalysisStartDate =} \FunctionTok{ifelse}\NormalTok{(AnalysisStartDate }\SpecialCharTok{==} \StringTok{""} \SpecialCharTok{|} 
                                 \FunctionTok{is.na}\NormalTok{(AnalysisStartDate), }\ConstantTok{NA}\NormalTok{,}
\NormalTok{                               AnalysisStartDate),}
    \AttributeTok{AnalysisEndDate =} \FunctionTok{ifelse}\NormalTok{(AnalysisEndDate }\SpecialCharTok{==} \StringTok{""} \SpecialCharTok{|} 
                               \FunctionTok{is.na}\NormalTok{(AnalysisEndDate), }
                             \ConstantTok{NA}\NormalTok{, AnalysisEndDate),}
    
    \CommentTok{\# Parse the dates with flexible parsing for character data}
    \AttributeTok{ActivityStartDate =}\NormalTok{ parse\_date\_time}
\NormalTok{    (ActivityStartDate, }\AttributeTok{orders =} \FunctionTok{c}\NormalTok{(}\StringTok{"dmy"}\NormalTok{, }\StringTok{"mdy"}\NormalTok{, }\StringTok{"ymd"}\NormalTok{)),}
    \AttributeTok{AnalysisStartDate =}\NormalTok{ parse\_date\_time}
\NormalTok{    (AnalysisStartDate, }\AttributeTok{orders =} \FunctionTok{c}\NormalTok{(}\StringTok{"dmy"}\NormalTok{, }\StringTok{"mdy"}\NormalTok{, }\StringTok{"ymd"}\NormalTok{)),}
    \AttributeTok{AnalysisEndDate =}\NormalTok{ parse\_date\_time}
\NormalTok{    (AnalysisEndDate, }\AttributeTok{orders =} \FunctionTok{c}\NormalTok{(}\StringTok{"dmy"}\NormalTok{, }\StringTok{"mdy"}\NormalTok{, }\StringTok{"ymd"}\NormalTok{))}
\NormalTok{  ) }\SpecialCharTok{\%\textgreater{}\%}
  
  \FunctionTok{mutate}\NormalTok{(}
    \AttributeTok{AnalysisYear =} \FunctionTok{case\_when}\NormalTok{(}
      \SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(AnalysisEndDate) }\SpecialCharTok{\textasciitilde{}} \FunctionTok{year}\NormalTok{(AnalysisEndDate),}
      \SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(AnalysisStartDate) }\SpecialCharTok{\textasciitilde{}} \FunctionTok{year}\NormalTok{(AnalysisStartDate),}
      \SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(ActivityStartDate) }\SpecialCharTok{\textasciitilde{}} \FunctionTok{year}\NormalTok{(ActivityStartDate),}
      \ConstantTok{TRUE} \SpecialCharTok{\textasciitilde{}} \ConstantTok{NA\_real\_}
\NormalTok{    )}
\NormalTok{  ) }\SpecialCharTok{\%\textgreater{}\%}
  
  \CommentTok{\# Drop rows where AnalysisYear is NA}
  \FunctionTok{filter}\NormalTok{(}\SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(AnalysisYear)) }\SpecialCharTok{\%\textgreater{}\%}
  
  \CommentTok{\# Drop original date columns}
  \FunctionTok{select}\NormalTok{(}\SpecialCharTok{{-}}\FunctionTok{c}\NormalTok{(ActivityStartDate, AnalysisStartDate, AnalysisEndDate))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Warning: There was 1 warning in `mutate()`.
i In argument: `AnalysisEndDate = parse_date_time(AnalysisEndDate, orders =
  c("dmy", "mdy", "ymd"))`.
Caused by warning:
! All formats failed to parse. No formats found.
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# View the processed dataset}
\FunctionTok{str}\NormalTok{(processed\_dataset)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
'data.frame':   273014 obs. of  10 variables:
 $ CharacteristicName                      : chr  "Calcium" "Calcium" "Calcium" "Chlorophyll a" ...
 $ ResultMeasureValue                      : chr  "65.2" "56.3" "81.7" "" ...
 $ ResultMeasure.MeasureUnitCode           : chr  "mg/L" "mg/L" "mg/L" "" ...
 $ ResultValueTypeName                     : chr  "Actual" "Actual" "Actual" "Actual" ...
 $ PrecisionValue                          : num  NA NA NA NA NA NA NA NA NA NA ...
 $ DataQuality.BiasValue                   : logi  NA NA NA NA NA NA ...
 $ ResultDepthHeightMeasure.MeasureValue   : num  NA NA NA NA NA NA NA NA NA NA ...
 $ ResultDepthHeightMeasure.MeasureUnitCode: chr  "" "" "" "" ...
 $ State                                   : chr  NA NA NA NA ...
 $ AnalysisYear                            : num  2013 2013 2013 2013 2013 ...
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{narrowrfilt }\OtherTok{\textless{}{-}}\NormalTok{ processed\_dataset }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{filter}\NormalTok{(}\FunctionTok{rowSums}\NormalTok{(}\FunctionTok{is.na}\NormalTok{(.) }\SpecialCharTok{|}\NormalTok{ . }\SpecialCharTok{==} \StringTok{""}\NormalTok{) }\SpecialCharTok{\textless{}}\NormalTok{ (}\FunctionTok{ncol}\NormalTok{(processed\_dataset) }\SpecialCharTok{/} \DecValTok{2}\NormalTok{))}

\CommentTok{\# View the filtered dataset}
\FunctionTok{head}\NormalTok{(narrowrfilt)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
  CharacteristicName ResultMeasureValue ResultMeasure.MeasureUnitCode
1            Calcium               91.5                          mg/L
2          Magnesium                6.6                          mg/L
3            Calcium                 37                          mg/L
4            Calcium               90.5                          mg/L
5            Calcium               60.9                          mg/L
6          Magnesium                6.4                          mg/L
  ResultValueTypeName PrecisionValue DataQuality.BiasValue
1              Actual             NA                    NA
2              Actual             NA                    NA
3              Actual             NA                    NA
4              Actual             NA                    NA
5              Actual             NA                    NA
6              Actual             NA                    NA
  ResultDepthHeightMeasure.MeasureValue
1                                    NA
2                                    NA
3                                    NA
4                                    NA
5                                    NA
6                                    NA
  ResultDepthHeightMeasure.MeasureUnitCode    State AnalysisYear
1                                          Colorado         2015
2                                          Colorado         2015
3                                          Colorado         2015
4                                          Colorado         2015
5                                          Colorado         2015
6                                          Colorado         2015
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{nrow}\NormalTok{(narrowrfilt)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 247307
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{colnames}\NormalTok{(narrowrfilt)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1] "CharacteristicName"                      
 [2] "ResultMeasureValue"                      
 [3] "ResultMeasure.MeasureUnitCode"           
 [4] "ResultValueTypeName"                     
 [5] "PrecisionValue"                          
 [6] "DataQuality.BiasValue"                   
 [7] "ResultDepthHeightMeasure.MeasureValue"   
 [8] "ResultDepthHeightMeasure.MeasureUnitCode"
 [9] "State"                                   
[10] "AnalysisYear"                            
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{colnames}\NormalTok{(final\_merged\_data)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1] "States"                                 
 [2] "avg_max_aqi"                            
 [3] "avg_x90th_percentile_aqi"               
 [4] "avg_median_aqi"                         
 [5] "avg_days_with_aqi"                      
 [6] "avg_good_days"                          
 [7] "avg_moderate_days"                      
 [8] "avg_unhealthy_for_sensitive_groups_days"
 [9] "avg_unhealthy_days"                     
[10] "avg_very_unhealthy_days"                
[11] "avg_hazardous_days"                     
[12] "avg_days_co"                            
[13] "avg_days_no2"                           
[14] "avg_days_ozone"                         
[15] "avg_days_pm2_5"                         
[16] "avg_days_pm10"                          
[17] "year"                                   
[18] "Total_Count"                            
[19] "Total_Population"                       
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{colnames}\NormalTok{(narrowrfilt)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1] "CharacteristicName"                      
 [2] "ResultMeasureValue"                      
 [3] "ResultMeasure.MeasureUnitCode"           
 [4] "ResultValueTypeName"                     
 [5] "PrecisionValue"                          
 [6] "DataQuality.BiasValue"                   
 [7] "ResultDepthHeightMeasure.MeasureValue"   
 [8] "ResultDepthHeightMeasure.MeasureUnitCode"
 [9] "State"                                   
[10] "AnalysisYear"                            
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{final\_merged\_data }\OtherTok{\textless{}{-}}\NormalTok{ final\_merged\_data }\SpecialCharTok{\%\textgreater{}\%}
  
  \FunctionTok{left\_join}\NormalTok{(narrowrfilt, }\AttributeTok{by =} \FunctionTok{c}\NormalTok{(}\StringTok{"States"} \OtherTok{=} \StringTok{"State"}\NormalTok{, }\StringTok{"year"} \OtherTok{=} \StringTok{"AnalysisYear"}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\FunctionTok{across}\NormalTok{(}\FunctionTok{everything}\NormalTok{(), }\SpecialCharTok{\textasciitilde{}}\FunctionTok{replace}\NormalTok{(., }\FunctionTok{is.na}\NormalTok{(.), }\StringTok{""}\NormalTok{)))}

\CommentTok{\# View the final merged dataset}
\FunctionTok{head}\NormalTok{(final\_merged\_data)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 6 x 27
  States     avg_max_aqi avg_x90th_percentile~1 avg_median_aqi avg_days_with_aqi
  <chr>      <chr>       <chr>                  <chr>          <chr>            
1 Alabama    145.523809~ 93.5714285714286       54.3809523809~ 184.238095238095 
2 Alaska     107         51.6666666666667       23.6666666666~ 194.166666666667 
3 Arizona    125.583333~ 79.4166666666667       48.75          221.166666666667 
4 Arkansas   112.944444~ 81.0555555555556       55.4444444444~ 118.944444444444 
5 California 222.321428~ 103.428571428571       51.5535714285~ 328.428571428571 
6 California 222.321428~ 103.428571428571       51.5535714285~ 328.428571428571 
# i abbreviated name: 1: avg_x90th_percentile_aqi
# i 22 more variables: avg_good_days <chr>, avg_moderate_days <chr>,
#   avg_unhealthy_for_sensitive_groups_days <chr>, avg_unhealthy_days <chr>,
#   avg_very_unhealthy_days <chr>, avg_hazardous_days <chr>, avg_days_co <chr>,
#   avg_days_no2 <chr>, avg_days_ozone <chr>, avg_days_pm2_5 <chr>,
#   avg_days_pm10 <chr>, year <chr>, Total_Count <chr>, Total_Population <chr>,
#   CharacteristicName <chr>, ResultMeasureValue <chr>, ...
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{colnames}\NormalTok{(final\_merged\_data)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1] "States"                                  
 [2] "avg_max_aqi"                             
 [3] "avg_x90th_percentile_aqi"                
 [4] "avg_median_aqi"                          
 [5] "avg_days_with_aqi"                       
 [6] "avg_good_days"                           
 [7] "avg_moderate_days"                       
 [8] "avg_unhealthy_for_sensitive_groups_days" 
 [9] "avg_unhealthy_days"                      
[10] "avg_very_unhealthy_days"                 
[11] "avg_hazardous_days"                      
[12] "avg_days_co"                             
[13] "avg_days_no2"                            
[14] "avg_days_ozone"                          
[15] "avg_days_pm2_5"                          
[16] "avg_days_pm10"                           
[17] "year"                                    
[18] "Total_Count"                             
[19] "Total_Population"                        
[20] "CharacteristicName"                      
[21] "ResultMeasureValue"                      
[22] "ResultMeasure.MeasureUnitCode"           
[23] "ResultValueTypeName"                     
[24] "PrecisionValue"                          
[25] "DataQuality.BiasValue"                   
[26] "ResultDepthHeightMeasure.MeasureValue"   
[27] "ResultDepthHeightMeasure.MeasureUnitCode"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{write\_csv}\NormalTok{(final\_merged\_data, }\StringTok{"final\_dataset\_consolidated.csv"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{str}\NormalTok{(final\_merged\_data)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
tibble [235,057 x 27] (S3: tbl_df/tbl/data.frame)
 $ States                                  : chr [1:235057] "Alabama" "Alaska" "Arizona" "Arkansas" ...
 $ avg_max_aqi                             : chr [1:235057] "145.52380952381" "107" "125.583333333333" "112.944444444444" ...
 $ avg_x90th_percentile_aqi                : chr [1:235057] "93.5714285714286" "51.6666666666667" "79.4166666666667" "81.0555555555556" ...
 $ avg_median_aqi                          : chr [1:235057] "54.3809523809524" "23.6666666666667" "48.75" "55.4444444444444" ...
 $ avg_days_with_aqi                       : chr [1:235057] "184.238095238095" "194.166666666667" "221.166666666667" "118.944444444444" ...
 $ avg_good_days                           : chr [1:235057] "69.7619047619048" "167.666666666667" "104.25" "69.3333333333333" ...
 $ avg_moderate_days                       : chr [1:235057] "88.3809523809524" "24.6666666666667" "91.4166666666667" "41.9444444444444" ...
 $ avg_unhealthy_for_sensitive_groups_days : chr [1:235057] "20" "1.5" "23.3333333333333" "6.38888888888889" ...
 $ avg_unhealthy_days                      : chr [1:235057] "5.66666666666667" "0.333333333333333" "2.16666666666667" "1.27777777777778" ...
 $ avg_very_unhealthy_days                 : chr [1:235057] "0.428571428571429" "0" "0" "0" ...
 $ avg_hazardous_days                      : chr [1:235057] "0" "0" "0" "0" ...
 $ avg_days_co                             : chr [1:235057] "2.23809523809524" "49.3333333333333" "0.25" "0.833333333333333" ...
 $ avg_days_no2                            : chr [1:235057] "0" "0" "12.6666666666667" "2.11111111111111" ...
 $ avg_days_ozone                          : chr [1:235057] "93.1904761904762" "59.6666666666667" "145.916666666667" "85.6666666666667" ...
 $ avg_days_pm2_5                          : chr [1:235057] "71.4761904761905" "50.1666666666667" "37.8333333333333" "30.1666666666667" ...
 $ avg_days_pm10                           : chr [1:235057] "17.3333333333333" "35" "24.5" "0.166666666666667" ...
 $ year                                    : chr [1:235057] "1999" "1999" "1999" "1999" ...
 $ Total_Count                             : chr [1:235057] "41" "0" "93" "0" ...
 $ Total_Population                        : chr [1:235057] "194723" "261961" "475824" "196611" ...
 $ CharacteristicName                      : chr [1:235057] "" "" "" "" ...
 $ ResultMeasureValue                      : chr [1:235057] "" "" "" "" ...
 $ ResultMeasure.MeasureUnitCode           : chr [1:235057] "" "" "" "" ...
 $ ResultValueTypeName                     : chr [1:235057] "" "" "" "" ...
 $ PrecisionValue                          : chr [1:235057] "" "" "" "" ...
 $ DataQuality.BiasValue                   : chr [1:235057] "" "" "" "" ...
 $ ResultDepthHeightMeasure.MeasureValue   : chr [1:235057] "" "" "" "" ...
 $ ResultDepthHeightMeasure.MeasureUnitCode: chr [1:235057] "" "" "" "" ...
\end{verbatim}




\end{document}
